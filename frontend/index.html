<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng quyết định phân độ TCM - DMN Priority</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Hệ phân loại Mức độ bệnh Tay chân miệng</h1>
            <p class="subtitle">Điền dữ liệu bệnh nhân dạng tick/nhập số — engine sẽ suy ra Độ (1 / 2a / 2b / 3 / 4).</p>
        </header>

        <!-- Rules & Result Section -->
        <div class="top-section">
            <!-- Rules JSON Editor -->
            <div class="card rules-card">
                <h3>Rules JSON</h3>
                <textarea id="rulesJsonEditor" class="rules-editor"></textarea>
                <p class="hint">Có thể mở rộng rules bằng cách dán thêm vào đây.</p>
            </div>

            <!-- Result Display -->
            <div class="card result-card">
                <h3>Kết quả suy diễn</h3>
                <div class="result-display">
                    <div class="degree-label">Độ: <span id="degreeResult" class="degree-value">Chưa đánh giá</span></div>
                </div>
                <div id="explanationSection" class="explanation hidden">
                    <div class="explain-row">Rule chọn: <span id="ruleId" class="code-badge"></span></div>
                    <div class="explain-row">Notes: <span id="ruleNotes"></span></div>
                    <div class="explain-row">Nguồn: <span id="ruleSource"></span></div>
                    <div class="explain-row opacity-70">Matched: <span id="matchedIds"></span></div>
                </div>
            </div>
        </div>

        <!-- Patient Data Form -->
        <div class="form-sections">
            <!-- Da - Niêm mạc -->
            <section class="form-section">
                <h3 class="section-title">Da – Niêm mạc</h3>
                <div class="fields-grid">
                    <label class="field-bool">
                        <input type="checkbox" id="RashHF">
                        <span>Phát ban tay–chân–miệng (RashHF)</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="OralUlcer">
                        <span>Loét miệng (OralUlcer)</span>
                    </label>
                </div>
            </section>

            <!-- Sốt – Tiêu hoá -->
            <section class="form-section">
                <h3 class="section-title">Sốt – Tiêu hoá</h3>
                <div class="fields-grid">
                    <label class="field-text">
                        <span class="field-label">Nhiệt độ tối đa (°C) – TempC</span>
                        <input type="number" id="TempC" step="0.1" class="input-field">
                    </label>
                    <label class="field-text">
                        <span class="field-label">Số ngày sốt – FeverDays</span>
                        <input type="number" id="FeverDays" class="input-field">
                    </label>
                    <label class="field-text">
                        <span class="field-label">Số lần nôn/giờ – VomitPerHour (ví dụ >2/h)</span>
                        <input type="text" id="VomitPerHour" class="input-field" placeholder="Ví dụ: >2/h">
                    </label>
                </div>
            </section>

            <!-- Thần kinh -->
            <section class="form-section">
                <h3 class="section-title">Thần kinh</h3>
                <div class="fields-grid">
                    <label class="field-bool">
                        <input type="checkbox" id="StartleObserved">
                        <span>Giật mình ghi nhận lúc khám – StartleObserved</span>
                    </label>
                    <label class="field-text">
                        <span class="field-label">Số lần giật mình/30' – StartleHist/30' (ví dụ ≥2)</span>
                        <input type="text" id="StartleHist/30'" class="input-field" placeholder="Ví dụ: ≥2">
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="Somnolent">
                        <span>Ngủ gà/bứt rứt – Somnolent</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="Nystagmus">
                        <span>Rung giật nhãn cầu (Nystagmus)</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="Ataxia">
                        <span>Mất điều hòa vận động (Ataxia)</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="LimbWeakness">
                        <span>Yếu/liệt chi – LimbWeakness</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="CranialNervePalsy">
                        <span>Liệt TK sọ – CranialNervePalsy</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="Hypertonia">
                        <span>Tăng trương lực – Hypertonia</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="Seizure">
                        <span>Co giật – Seizure</span>
                    </label>
                    <label class="field-text">
                        <span class="field-label">Thang điểm Glasgow (GCS)</span>
                        <input type="number" id="GCS" class="input-field">
                    </label>
                    <label class="field-text">
                        <span class="field-label">Mức độ tỉnh táo (AVPU) {A,V,P,U}</span>
                        <input type="text" id="AVPU" class="input-field" value="A">
                    </label>
                </div>
            </section>

            <!-- Tuần hoàn – Hô hấp -->
            <section class="form-section">
                <h3 class="section-title">Tuần hoàn – Hô hấp</h3>
                <div class="fields-grid">
                    <label class="field-text">
                        <span class="field-label">Mạch đo được (bpm)</span>
                        <input type="number" id="hrMeasured" class="input-field">
                    </label>
                    <div class="field-text">
                        <button id="calcHRBtn" class="btn-primary">Tính HR (không sốt)</button>
                    </div>
                    <label class="field-text">
                        <span class="field-label">HR (không sốt) – điền tự động</span>
                        <input type="number" id="HR (không sốt)" class="input-field" readonly>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="SBP_HighForAge">
                        <span>SBP_HighForAge (HA tâm thu tăng theo tuổi)</span>
                    </label>
                    <label class="field-text">
                        <span class="field-label">SBP (mmHg) – SBP_mmHg</span>
                        <input type="number" id="SBP_mmHg" class="input-field">
                    </label>
                    <label class="field-text">
                        <span class="field-label">Điều kiện tuổi – AgeMonthsCond (<12m | ≥12m)</span>
                        <input type="text" id="AgeMonthsCond" class="input-field" placeholder="<12m hoặc ≥12m">
                    </label>
                    <label class="field-text">
                        <span class="field-label">Chênh áp – PulsePressure (mmHg)</span>
                        <input type="number" id="PulsePressure" class="input-field">
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="RR_HighForAge">
                        <span>RR_HighForAge (thở nhanh theo tuổi)</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="StridorInsp">
                        <span>StridorInsp – thở rít thì hít</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="ShallowBreath">
                        <span>ShallowBreath – thở nông</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="AbdominalBreath">
                        <span>AbdominalBreath – thở bụng</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="ChestRetraction">
                        <span>ChestRetraction – rút lõm ngực</span>
                    </label>
                    <label class="field-text">
                        <span class="field-label">Độ bão hòa oxy (SpO₂) %</span>
                        <input type="number" id="SpO₂" class="input-field">
                    </label>
                    <label class="field-text">
                        <span class="field-label">Thời gian đổ đầy mao mạch (CRT) – giây</span>
                        <input type="number" id="CRTsec" class="input-field" step="0.1">
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="MottledSkin">
                        <span>Da nổi bông – MottledSkin</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="ColdExtOrSweat">
                        <span>Chi lạnh / vã mồ hôi – ColdExtOrSweat</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="Apnea">
                        <span>Ngưng thở – Apnea</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="RespIrregularSevere">
                        <span>Rối loạn nhịp thở nặng – RespIrregularSevere</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="PulmEdemaPinkFroth">
                        <span>Phù phổi – sùi bọt hồng – PulmEdemaPinkFroth</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="LungRalesWet">
                        <span>Phù phổi – ran ẩm phổi – LungRalesWet</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="PulseAbsent">
                        <span>Mạch không bắt được – PulseAbsent</span>
                    </label>
                    <label class="field-bool">
                        <input type="checkbox" id="BPUnrecordable">
                        <span>Huyết áp không đo được – BPUnrecordable</span>
                    </label>
                </div>
            </section>
        </div>

        <!-- Export Section -->
        <div class="card export-section">
            <h3>Xuất dữ liệu</h3>
            <button id="exportCsvBtn" class="btn-export">Xuất (file .csv)</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/engine.js"></script>
    <script src="../assets/js/app.js"></script>
</body>
</html>
